[% IF criterion %]
  [% IF criterion.type == 'category' %]
    [% my_params = ';cat=' _ criterion.value.lower %]
  [% ELSIF criterion.type == 'locale' %]
    [% my_params = ';loc=' _ criterion.value.lower %]
  [% END %]

  [% INCLUDE header.tt 
      page_title = "Index of $criterion.name - $site_name"
      feed_base = "$cgi_url?action=index" _ my_params
   %]
[% ELSE %]
  [% INCLUDE header.tt page_title = "Things within $limit of $origin - $site_name" %]
[% END %]
[% INCLUDE banner.tt %]
<div id="content">
[% INCLUDE navbar.tt %]
<div id="maincontent">
<h2>Node List
  [%- IF criterion -%]
    [%- IF criterion.url -%]
      - <a href="[% criterion.url %]">[%- criterion.name -%]</a>
    [%- ELSE -%]
      - [%- criterion.name -%]
    [%- END -%]
  [%- END -%]
  [%- IF origin -%]
    - Things within [%- limit -%] of <a href="[% cgi_url %]?[%- origin_param -%]">[%- origin -%]</a>
  [%- END -%]
</h2>
<ol>
  [% FOREACH node = nodes %]
     <li><a href="[% cgi_url %]?[% node.param %]">[% node.name %]</a>
         [% IF node.distance %]([% node.distance %] metres away)[% END %]
     </li>
  [% END %]
</ol>
</div>

[%# my_params is set at the top of this file %]
<p>
  This list is available as
  <a href="[% cgi_url %]?action=index[% my_params %];format=rdf">rdf</a>,
  or as a
  <a href="[% cgi_url %]?action=index[% my_params %];format=rss">rss feed</a>,
  or as an
  <a href="[% cgi_url %]?action=index[% my_params %];format=atom">atom
  feed</a>.
</p>

[% INCLUDE footer.tt %]
